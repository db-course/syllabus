[Назад к главной странице курса](https://github.com/db2015ss/syllabus)

# Инструкция по использованию Git для сдачи лабораторных работ

Для лабораторных работ 3, 4 и 5 предусмотрена онлайн-сдача на сайте GitHub. Для этого нужно проделать ряд шагов, описанных ниже. Следует отметить, что данная инструкция не может претендовать не только на полноту описания возможностей Git, но даже на полноценное введение, поскольку не описывает и 10% его самых базовых функций. Для более глубокого понимания сути и принципов работы с Git обратитесь к ссылкам в конце данной инструкции.

_Примечание_: Ниже приведены консольные команды системы контроля версий Git. Существует также большое количество GUI-клиентов этой системы, их использование допускается, но не рекомендуется при отсутствии опыта работы с ними.

## Настройка рабочей среды

Необходимо создать аккаунт на сайте GitHub, если у вас его еще нет. Это можно сделать на главной странице https://github.com/ Бесплатный аккаунт позволяет создавать неограниченное количество публичных репозиториев. Рекомендуется использовать реальный e-mail, поскольку через него будут осуществляться оповещения по ходу курса.

_Для чего используется в реальной жизни_: GitHub — крупнейший сервис для хостинга исходного кода и совместной разработки ПО, построенный на системе управления версиями Git.

Далее следует установить клиент системы управления версиями Git для вашей ОС. http://git-scm.com/downloads Он будет необходим для взаимодействия с сервером GitHub, а именно создания локальных репозиториев и отправки лабораторных работ на сервер. При установке в Windows необходимо выбрать опцию Use Git from the Windows Command Prompt, для того, чтобы иметь возможность выполнять команды git из стандартного интерпретатора команд Windows cmd.exe.

_Для чего используется в реальной жизни_: Git — распределенная система управления исходными кодами программ. Используется для совместной работы с текстовой информацией. Позволяет хранить несколько версий документов и при необходимости переходить между ними. Также имеется возможность создания параллельных версий наборов документов с собственной хронологией, их объединение и множество других возможностей совместной разработки.

После установки требуется настроить клиент. Для этого из консоли требуется выполнить команды:

1.
```
git config --global user.name "ВАШЕ ИМЯ ПОЛЬЗОВАТЕЛЯ"
```

ВАШЕ ИМЯ ПОЛЬЗОВАТЕЛЯ — имя, которым будут подписаны ваши изменения. Рекомендуется выбрать такое имя, чтобы оно совпадало с вашим именем пользователя на GitHub.

2.
```
git config --global user.email "ВАШ EMAIL"
```

ВАШ EMAIL — адрес электронной почты, который указан в вашем профиле на GitHub.

## Регистрация в организации, тренировка работы с Git и GitHub

Для того, чтобы выполнять лабораторные работы 3-5, нужно быть членом организации db2015ss на GitHub. Для этого необходимо после регистрации на GitHub подать заявку на вступление, которую принимает преподаватель. Для этого необходимо открыть issue (проблему) в репозитории [db2015ss/students](https://github.com/db2015ss/students). 

Для этого, перейдя на страницу этого репозитория, необходимо переключиться на вкладку issues.

ИЛЛЮСТРАЦИЯ!

Далее следует нажать кнопку New issue (Новая проблема), и в открывшемся окне написать текст проблемы (в данном случае — ФИО и группу).

ИЛЛЮСТРАЦИЯ!

После этого следует нажать кнопку Submit new issue (Отправить новую проблему). Проблема будет опубликована. 

_Для чего используется в реальной жизни_: Issues (проблемы) — обсуждения, создаваемые для проекта людьми, являющимися или не являющимися его участниками и видимые для всех, с возможностью комментирования, изменения статуса и пр. Является средством коммуникации команды проекта с внешним миром и коллективного обсуждения имеющихся в проекте проблем или нерешенных задач.

Когда преподаватель обработает запрос, на почту будет выслано оповещение, а на странице организации появится приглашение на вступление.

Иллюстрация

Нужно принять его.

Иллюстрация

Когда вы станете членом организации db2015ss, вам станут доступны один или несколько приватных (невидимых для пользователей, не являющихся членами) репозиториев, каждый из которых относится к какой-либо из лабораторных работ, для которых предусмотрена сдача на GitHub. Можно приступать к выполнению лабораторных работ 3-5.

ИЛЛЮСТРАЦИЯ!

Если есть желание потренироваться в использовании приемов работы с GitHub, можно использовать в качестве песочницы репозиторий [db2015ss/students](https://github.com/db2015ss/students). В его описании указано, для чего он предназначен и как с помощью него можно отработать навыки  перед сдачей лабораторных работ.

## Подготовка к выполнению лабораторной работы

Необходимо форкнуть (fork) приватный репозиторий, относящийся к лабораторной работе, которую вы хотите сдать. Для этого необходимо зайти в репозиторий, соответствующий работе (например, db2015ss/labwork3 для 3-й ЛР) и нажать кнопку Fork.

Иллюстрация.

Через несколько секунд на сервере GitHub будет создана ваша копия репозитория проекта.

Иллюстрация

Вы будете работать с ней, внося изменения в виде кода лабораторной работы, а затем для сдачи работы делать pull-request (запрос на включение) в исходный репозиторий, где его будет просматривать и оценивать преподаватель.

_Для чего используется в реальной жизни_: форк репозитория проекта — создание копии проекта на сервере. Это может преследовать разные цели: 
* Внесение собственного вклада в развитие чужого проекта. Для этого можно вносить соответствующие улучшения в свою копию проекта, а впоследствии путем использования pull-request (запроса на включение) предложить принять их в исходный проект его хозяину.
* Создание собственного проекта на базе существующего.

После создания форка на сервере GitHub нужно клонировать его на свой собственный компьютер. Откройте интрепретатор команд (cmd.exe), перейдите к каталогу, в котором будете выполнять лабораторные работы (например d:\db\lr), и выполните команду

```
git clone https://github.com/ВАШЕ ИМЯ/ИМЯ РЕПОЗИТОРИЯ С ЛР
```

Например, если студент с именем пользователя ivanov собирается клонировать репозиторий с 3-1 ЛР для того, чтобы выполнить ее, необходимо выполнить команду

```
git clone https://github.com/ivanov/labwork3
```

Поскольку это приватный репозиторий, клиент попросит ввести ваше имя пользователя и пароль, чтобы проверить, обладаете ли вы правами на чтение из него. В случае успешной аутентификации репозиторий будет склонирован.

Будет создан локальный каталог (в данном случае labwork3), содержащий файл-шаблон скрипта лабораторной работы (имеет расширение .sql) и README.md (текстовый файл с описанием репозитория в формате markdown). Можно приступать к редактированию файла скрипта.

## Выполнение лабораторной работы

Изменения следует вносить в .sql-файл, расположенный в локальном клоне вашего репозитория. Эта локальная копия также представляет собой репозиторий, который связан с исходным так ссылкой origin (источник). Все изменения, которые вы вносите в файл, следует сначала сохранять в локальном репозитории, а затем направлять в репозиторий-источник (ваш форк, лежащий на сервере GitHub).

Вы изменили файл со скриптом, сохранили его и хотите записать его состояние в локальный репозиторий. Для этого нужно сначала поместить его в индекс (stage) — промежуточный список файлов, который затем будет зафиксирован в качестве текущего состояния. Необходимо выполнить команду

```
git add имя_файла
```

Она добавит в индекс файл, который вы укажете. Проверить состояние индекса можно командой

```
git status
```

Если изменения в файлы с момента предыдущей фиксации не вносились, статус будет пустым. Если есть неиндексированные изменения (были изменены отслеживаемые файлы, уже добавленные в индекс файлы или добавлены новые файлы), то соответствующие файлы будут отмечены красным цветом. После внесения командой add состояния файла в индекс соответствующий файл будет отображен зеленым цветом как готовый к фиксации.

Фиксация состояния файла (commit) выполняется командой

```
git commit -m "ОПИСАНИЕ СОСТОЯНИЯ"
```

Здесь ОПИСАНИЕ СОСТОЯНИЯ — ваше сообщение, описывающее, что именно вы сохраняете. Например, так:

```
git commit -m "Добавлены операторы удаления таблиц"
```

После выполнения команды commit изменения зафиксированы в локальном репозитории.

_Для чего используется в реальной жизни_: commit (коммит) — снимок состояния проекта в конкретный набор времени, также может быть рассмотрен как список изменений (diff), внесенный разработчиком в предыдущее состояние проекта. Цель системы контроля версий - обеспечение доступа пользователей к состоянию проекта в любой момент времени. Список коммитов представляет собой историю изменений конкретной ветки проекта. Можно получить к нему доступ командой git log. При публикации на сервер публикуются не только сами файлы, но и все их версии со связанными с ними изменениями. Например, список изменений репозитория с описанием этого курса можно посмотреть здесь: https://github.com/db2015ss/syllabus/commits/master

Нет четкой рекомендации, сколько коммитов необходимо делать для одной лабораторной работы. 

Можно наращивать изменения постепенно и документировать их, например:

```
git status
(нет изменений)
```
_...редактирование файлов..._
```
git status
(есть неиндексированные изменения, выделены красным цветом)
git add измененные_файлы
git status
(все изменения индексированы, выделены зеленым цветом)
```
_...увидели, что пропущена точка с запятой, редактирование файлов..._
```
git status
(есть неиндексированные изменения, выделены красным цветом)
git add измененные_файлы
git status
(все изменения индексированы, выделены зеленым цветом)
git commit -m "Добавлены операторы создания таблиц"
```
_...редактирование файлов..._
```
git status
(есть неиндексированные изменения, выделены красным цветом)
git add измененные_файлы
git status
(все изменения индексированы, выделены зеленым цветом)
git commit -m "Таблицы Группа и Студент заполнены данными"
```

С другой стороны, можно отредактировать файл полностью, проиндексировать и закоммитить его. Это немного противоречит философии системы контроля версий, поскольку будет всего две версии вашего репозитория, начальная и исходная, без промежуточных, но допускается в учебных работах.

## Сдача лабораторной работы

Для сдачи работы необходимо переписать (опубликовать) историю изменений (коммитов) из локального репозитория на сервер, в созданный вами репозиторий-форк. Напомним, на него указывает ссылка origin.

Для публикации истории служит команда push:

```
git push origin master
```

В ней указывается, в какой репозиторий происходит публикация (origin — репозиторий-источник, который был клонирован) и какой ветви (master — главная ветвь). У проекта может быть несколько ветвей, но ветвление не используется при сдаче лабораторных работ и здесь не рассмотрено.

При публикации у вас могут быть затребованы учетные данные сайта GitHub, чтобы проверить, обладаете ли вы достаточными правами.

Публикация коммитов на сервер может быть не окончательной, вы можете продолжать работать над файлами, фиксировать изменения и публиковать их столько, сколько будет необходимо.

Чтобы сдать работу, необходимо отослать историю ваших изменений в центральный репозиторий этой работы в организации db2015ss. Там их увидит и оценит преподаватель. 

Выполнить push вы не сможете, т.к. не обладаете правами на запись в центральный репозиторий данной работы. Вместо этого вы можете отправить запрос на включение изменений (pull-request), и преподаватель получит уведомление о нем. 

_Для чего используется в реальной жизни_: pull-request (запрос на включение) — основной способ вклада в проекты в открытым исходным кодом лицами, не являющимися членами проекта, но имеющими желание помочь. Помимо того, pull-request'ы могут использоваться внутри команды разработчиков проекта для обсуждения внесения изменений из одних ветвей проекта в другие.

Для создания pull-request'а зайдите на страницу своего репозитория и нажмите кнопку слева Compare and review.

ИЛЛЮСТРАЦИЯ

Затем нажмите Create pull request.

Иллюстрация

Нс следующей странице вам будет предложено написать заголовок и комментарий к своему запросу. Не пренебрегайте этим.

ИЛЛЮСТРАЦИЯ

Кнопка Create pull request внизу отправит ваш запрос на рассмотрение преподавателю.

Преподаватель сможет оставлять комментарии к вашему pull-request'у (например, для уточнения или указания на ошибки).

ИЛЛЮСТРАЦИЯ

Вы можете также отвечать на комментарии.

ИЛЛЮСТРАЦИЯ

При появлении новых событий, связанных со сдачей работы, в правом верхнем углу будет отображено уведомление.

ИЛЛЮСТРАЦИЯ

Если вам необходимо доделать работу или исправить ошибки, то следует выполнить изменения в рабочем каталоге, зафиксировать их в локальном репозитории (подраздел "Выполнение лабораторной работы" данной инструкции) и опубликовать их в своем репозитории на GitHub (команда push). Эти изменения автоматически появятся в pull-request'е и будут доступны для рассмотрения преподавателем.

В случае успешной сдачи преподаватель отмечает это соответствующим комментарием.

## Если что-то пошло не так...

В этом подразделе описаны некоторые ситуации, которые могут произойти по ошибке пользователя и привести к затруднению выполнения работы и могут быть исправлены с использованием системы Git.

__Неприятность 1__. Испорчены файлы в рабочей директории. Например, нечаянно удалены файлы / стерто содержимое / на клавиатуру легла кошка, заполнила файл бессмыслицей и сохранила изменения.

_Решение_. Можно откатиться к последнему коммиту (фиксации), которая была сделана в локальном репозитории командой

```
git reset --hard
```

Не выполняйте эту команду от нечего делать, она сотрет все ваши изменения с момента последней фиксации.

Если вы не фиксируете изменения постепенно, командой будет выполнен откат на начальное состояние репозитория.

__Неприятность 2__. Вы зафиксировали в локальный репозиторий испорченное состояние работы. Например, вы сделали фиксацию без текстового описания и стыдитесь этого / вы сделали и зафиксировали изменения, а потом осознали, что их не следовало делать, так как это не ваш вариант лабораторной / кошка в дополнение к предыдущему выполнила команды git add и git commit / вы по ошибке вместо файла с кодом записали в репозиторий фотографию своей кошки.

_Решение_. Необходимо "переписать историю", то есть сместить указатель HEAD на предыдущий коммит, а также отменить все незафиксированные изменения в репозиторий. Для этого можно выполнить команду:

```
git reset --hard HEAD~1
```

Эта команда еще страшнее, чем предыдущая, поскольку она удаляет не только все незафиксированные изменения, но и данные последней фиксации. Не следует выполнять ее от скуки.

__Неприятность 3__. Вы зафиксировали в локальный репозиторий неполное изменение. Например, вы забыли дописать команду создания одной из таблиц или отформатировать код.

_Решение_. Можно временно сместить указатель HEAD, доделать локальные изменения, а затем вернуть его обратно, сохранив предыдущее описание коммита. Для этого можно выполнить команды:

```
git reset --soft HEAD~1
```
_...необходимые изменения..._
```
git commit -a -C ORIG_HEAD
```

Последняя команда восстанавливает исходное состояние указателя HEAD, сохраняя описание коммита.

__Неприятность 4__. Вы зафиксировали "плохой" коммит (см. неприятности 2 и 3) и опубликовали его (выполнили push в свой репозиторий на сайте).

_Решение_. Не стоит использовать два предыдущих варианта "переписывания истории" командой reset, поскольку репозиторий на сайте доступен не только вам, и другие пользователи теоретически могут использовать коммиты, от которых вы хотите избавиться. Это может привести к осложнениям для них. В случае, если вам нужно исправить ошибки в опубликованных коммитах, вы должны создать новые коммиты, содержащие исправления, и опубликовать их. Следующие команды создают новый коммит, отменяющий изменения предыдущего, и публикуют его:

```
git revert HEAD
git push origin master
(на этом этапе вы опубликовали отмену ранее опубликованных изменений)
```
_...если нужно что-то доделать, то необходимые изменения..._
```
git add имена_файлов
git commit -m "Доработка"
git push origin master
```

Неправильный коммит сохранится в истории, но будет исправлен следующими.

__Неприятность 5__. Вы зафиксировали "плохой" коммит (см. неприятности 2 и 3), опубликовали его (выполнили push в свой репозиторий на сайте) и выполнили pull-request, попытавшись сдать работу преподавателю.

_Решение_. Использовать reset, также как и в предыдущем случае, нельзя, поскольку изменения были опубликованы. Хорошая новость в том, что для того, чтобы поменять содержимое pull-request'а нужно просто опубликовать исправленный коммит и, если необходимо, дополнения. Решение полностью совпадает с предыдущим.

### Материалы на русском языке для самостоятельного углубленного изучения

* http://habrahabr.ru/post/125799/
* http://githowto.com/ru
* http://git-scm.com/book/ru/v1
* http://www-cs-students.stanford.edu/~blynn/gitmagic/intl/ru/

[Назад к главной странице курса](https://github.com/db2015ss/syllabus)